CREATE TABLE `Dept` (
    `Id` int(10) unsigned NOT NULL AUTO_INCREMENT,
    `Parent_Id` int(10) unsigned default '0',
    `Name` varchar(50),
    primary key(`Id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
;

insert into Dept(Parent_Id, Name) values ( 0, 'root');
insert into Dept(Parent_Id, Name) values ( 1, '1');
insert into Dept(Parent_Id, Name) values ( 1, '2');
insert into Dept(Parent_Id, Name) values ( 2, '1.1');
insert into Dept(Parent_Id, Name) values ( 2, '1.2');
insert into Dept(Parent_Id, Name) values ( 3, '2.1');
insert into Dept(Parent_Id, Name) values ( 6, '2.1.1');
insert into Dept(Parent_Id, Name) values ( 1, '3');
insert into Dept(Parent_Id, Name) values ( 10, '1.1.1.1');
insert into Dept(Parent_Id, Name) values ( 4, '1.1.1');


CREATE DEFINER=`root`@`localhost` FUNCTION `dept_connect_by_parent`() RETURNS int(11)
    READS SQL DATA
BEGIN
    DECLARE _id INT;
    DECLARE _parent INT;
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET @id = NULL;
 
    SET _parent = @id;
    SET _id = -1;

    IF @id IS NULL THEN
        RETURN NULL;
    END IF;
 
    LOOP
        SELECT  MIN(Id)
        INTO    @id
        FROM    Dept
        WHERE   Parent_id = _parent
            AND Id > _id;
        
 IF @id IS NOT NULL OR _parent = @start_with THEN
            SET @level = @level + 1;
            RETURN @id;
        END IF;
  
        SET @level := @level - 1;
        
 SELECT  Id, Parent_id
        INTO    _id, _parent
        FROM    Dept
        WHERE   Id = _parent;
    END LOOP;
END
;


SELECT CONCAT(REPEAT('  ', level  - 1), d.name) AS name, d.Id, d.Parent_id, func.level FROM
(
SELECT dept_connect_by_parent() AS id, @level as level
    FROM    (
        SELECT  @start_with := 0,
                      @id := @start_with,
                      @level := 0
         ) vars, Dept
            WHERE   @id IS NOT NULL
) func
Join Dept d 
ON func.id = d.Id



;

출처 : http://blog.naver.com/PostView.nhn?blogId=endstar7&logNo=100124603859&categoryNo=32&viewDate=&currentPage=1&listtype=0